<h1>Map export</h1>

<style>
img.export_status {
	float:left;
	margin-right:4px;
}
p.export_status {
	width:70px;
}
a.export_button {

	padding:6px;
	border:2px solid #900;
	margin:2px;
	line-height:44px;
	background:#c00;
	color:#fff;
	text-decoration:none;
	font-family: lucida grande, helvetica, sans-serif;
	font-size: 14pt;
	font-weight:bold;	

}
</style>

<p>From this panel you can export this map in a variety of formats. These may already be available, but if you've changed the map at all, or want to see the most recent version, you can <b>re-generate the export</b>.</p>

<p>This may take some time - a large map could take as long as <b>an hour or more</b>. Leave this panel open to monitor progress, or come back later to see how it's going. Closing this panel will not stop the export.</p>

<div <% if @running %>style="display:none;"<% end %> id="run_export">Click this link to begin the export: <br />
<a class="export_button" href="javascript:void(0);" onClick="new Ajax.Request('/map/export/<%= @map.name %>?authenticity_token=<%= form_authenticity_token %>')">Export</a>
</div>

<div <% if !@running %>style="display:none;"<% end %> id="running_export">This map is currently building an export. Status is displayed below.</div>

<script>
new Ajax.PeriodicalUpdater('export_progress','/map/progress/<%= @map.id %>', {method: 'get', frequency: 5})
</script>
<p class='export_status'>
<b>Status:</b> <span id='export_progress'>
Loading...
</span></p>

<div>
<% unless @export.nil? %>
<% if @export.tms %>
<p>
<a href="/tms/<%= @map.name %>">Tiled Map Service (TMS)</a><br />
<a href="/tms/<%= @map.name %>/openlayers.html">OpenLayers viewer</a>
</p>
<% end %>
<% if @export.geotiff %>
<p>
<a href="/warps/<%= @map.name %>/<%= @map.name %>-geo.tif">GeoTIFF</a> (<%= @export.cm_per_pixel %> cm/px, <%= number_to_human_size(@export.size) %>, <%= @export.width %> x <%= @export.height %> px)
</p>
<% end %>
<% if @export.jpg %><% end %>
<% end %>
</div>

<p>Export links may be unavailable while the export is running.</p>
